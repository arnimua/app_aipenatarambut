import { useState, useEffect, useRef } from 'react';

// Ikon-ikon dari Heroicons atau Lucide-React (untuk contoh ini, kita akan menggunakan SVG inline)
const SparklesIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.286L13 21l-2.286-6.857L5 12l5.714-2.286L13 3z" />
  </svg>
);
const CameraIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.868-1.513A2 2 0 0113.674 4h.652a2 2 0 011.664.89l.868 1.513A2 2 0 0019.07 7H21a2 2 0 012 2v9a2 2 0 01-2 2H3a2 2 0 01-2-2V9z" />
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
  </svg>
);
const ExternalLinkIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
  </svg>
);
const UserIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
  </svg>
);
const BriefcaseIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 13.75v-3.5a2 2 0 00-2-2h-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v1.25H3a2 2 0 00-2 2v3.5a2 2 0 002 2h2v1.75a2 2 0 002 2h10a2 2 0 002-2v-1.75h2a2 2 0 002-2z" />
  </svg>
);
const XIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
  </svg>
);
const ArrowRightIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 8l4 4m0 0l-4 4m4-4H3" />
  </svg>
);
const ArrowLeftIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
  </svg>
);
const QuestionMarkCircleIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.228 9.255a3.75 3.75 0 100 5.492m0-5.492a7.502 7.502 0 0115 0m-15 0a7.502 7.502 0 0015 0m-15 0h.008v.008H8.228V9.255z" />
  </svg>
);
const AlertIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
    <path fillRule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm8.706-1.5a1.5 1.5 0 10-3 0v3.75a1.5 1.5 0 103 0v-3.75zM12 6.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 10.5a.75.75 0 10-1.5 0 .75.75 0 011.5 0z" clipRule="evenodd" />
  </svg>
);

const App = () => {
  const [screen, setScreen] = useState('api-key');
  const [apiKey, setApiKey] = useState(localStorage.getItem('geminiApiKey') || '');
  const [age, setAge] = useState('');
  const [job, setJob] = useState('');
  const [image, setImage] = useState(null);
  const [loading, setLoading] = useState(false);
  const [recommendations, setRecommendations] = useState([]);
  const [error, setError] = useState(null);
  const [isCameraActive, setIsCameraActive] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  
  // Ref untuk elemen video dan canvas
  const videoRef = useRef(null);
  const canvasRef = useRef(null);
  const videoStreamRef = useRef(null);

  // Fungsi untuk mengkonversi file menjadi base64
  const fileToBase64 = (file) => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result.split(',')[1]);
      reader.onerror = error => reject(error);
    });
  };
  
  // Logika untuk API call
  const handleGenerateRecommendation = async () => {
    setLoading(true);
    setRecommendations([]);
    setError(null);
    
    // Perbarui prompt untuk meminta struktur yang lebih terorganisir
    const prompt = `Analisis gambar wajah di bawah ini. Berdasarkan bentuk wajah, usia ${age} tahun, dan pekerjaan sebagai ${job}, berikan 3-4 rekomendasi model rambut yang cocok. Untuk setiap rekomendasi, berikan judul utama (misal: Potongan Solid), kemudian berikan judul spesifik (misal: Classic Taper with Side Part), tingkat kesulitan (Mudah/Sedang/Sulit), deskripsi, dan tips perawatan. Respon harus dalam format JSON yang berisi array objek rekomendasi. Gunakan format berikut:\n\n[{"judul": "Potongan Solid","subJudul": "Classic Taper with Side Part","tingkatKesulitan": "Mudah","deskripsi": "Potongan ini sangat cocok untuk rambut lurus dan wajah oval. Perawatannya sederhana dan tidak memerlukan banyak styling.", "tipsPerawatan": ["Gunakan pomade berbasis air untuk kilau alami.", "Keringkan rambut dengan handuk untuk tekstur.", "Rutin potong rambut setiap 3-4 minggu."]}, {"judul": "Potongan Modern & Stylish","subJudul": "Textured Crop","tingkatKesulitan": "Sedang","deskripsi": "Gaya ini memberikan volume pada bagian atas dan tekstur yang menarik. Cocok untuk wajah persegi atau bulat.", "tipsPerawatan": ["Gunakan clay atau wax untuk tekstur.", "Keringkan rambut dengan pengering rambut untuk volume.", "Gunakan jari-jari untuk menata rambut."]}, ...]`;

    const payload = {
      contents: [{
        role: "user",
        parts: [{ text: prompt }, {
          inlineData: {
            mimeType: "image/jpeg",
            data: image
          }
        }]
      }],
      generationConfig: {
          responseMimeType: "application/json",
          responseSchema: {
              type: "ARRAY",
              items: {
                  type: "OBJECT",
                  properties: {
                      "judul": { "type": "STRING" },
                      "subJudul": { "type": "STRING" },
                      "tingkatKesulitan": { "type": "STRING", "enum": ["Mudah", "Sedang", "Sulit"] },
                      "deskripsi": { "type": "STRING" },
                      "tipsPerawatan": { "type": "ARRAY", "items": { "type": "STRING" } }
                  },
                  "propertyOrdering": ["judul", "subJudul", "tingkatKesulitan", "deskripsi", "tipsPerawatan"]
              }
          }
      }
    };
    
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

    try {
      let response;
      let delay = 1000;
      const maxRetries = 5;
      let retries = 0;

      while (retries < maxRetries) {
        try {
          response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (response.status === 429) {
            await new Promise(resolve => setTimeout(resolve, delay));
            delay *= 2;
            retries++;
            continue;
          }
          if (!response.ok) {
            throw new Error(`Error ${response.status}: ${await response.text()}`);
          }
          break;
        } catch (err) {
          if (retries < maxRetries - 1) {
            await new Promise(resolve => setTimeout(resolve, delay));
            delay *= 2;
            retries++;
          } else {
            throw err;
          }
        }
      }

      if (!response.ok) {
        throw new Error('Gagal menghubungi API setelah beberapa percobaan.');
      }
      
      const jsonResult = await response.json();
      const text = jsonResult?.candidates?.[0]?.content?.parts?.[0]?.text;

      if (text) {
        const parsedJson = JSON.parse(text);
        setRecommendations(parsedJson);
        setScreen('result');
      } else {
        setError("Tidak ada hasil yang valid dari AI. Silakan coba lagi.");
      }
    } catch (err) {
      console.error('Error:', err);
      setError(`Terjadi kesalahan: ${err.message}. Pastikan kunci API Anda benar.`);
    } finally {
      setLoading(false);
    }
  };

  // Efek untuk mengaktifkan kamera
  useEffect(() => {
    if (isCameraActive) {
      const enableCamera = async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
          videoRef.current.srcObject = stream;
          videoStreamRef.current = stream;
        } catch (err) {
          console.error("Gagal mengakses kamera:", err);
          setError("Gagal mengakses kamera. Pastikan Anda telah memberikan izin.");
          setIsCameraActive(false);
        }
      };
      enableCamera();
    } else {
      // Hentikan stream jika kamera tidak aktif
      if (videoStreamRef.current) {
        videoStreamRef.current.getTracks().forEach(track => track.stop());
      }
    }
  }, [isCameraActive]);

  // Handler untuk ambil foto dari kamera
  const handleCaptureImage = () => {
    const video = videoRef.current;
    const canvas = canvasRef.current;
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const dataUrl = canvas.toDataURL('image/jpeg');
    setImage(dataUrl.split(',')[1]);
    setIsCameraActive(false);
  };
  
  const handleNextStep = () => {
    if (screen === 'api-key' && apiKey) {
      localStorage.setItem('geminiApiKey', apiKey);
      setScreen('welcome');
    } else if (screen === 'welcome') {
      setScreen('form');
    }
  };

  const handleBackToWelcome = () => {
    setScreen('welcome');
    setRecommendations([]);
    setImage(null);
    setAge('');
    setJob('');
  };
  
  // Fungsi untuk membuka Google Images
  const handleOpenGoogleImages = (query) => {
    const url = `https://www.google.com/search?tbm=isch&q=${encodeURIComponent(query)}`;
    window.open(url, '_blank');
  };
  
  const getBorderColor = (difficulty) => {
    switch (difficulty) {
      case 'Mudah':
        return 'border-green-600';
      case 'Sedang':
        return 'border-yellow-600';
      case 'Sulit':
        return 'border-red-600';
      default:
        return 'border-slate-600';
    }
  };

  const getDifficultyClass = (difficulty) => {
    switch (difficulty) {
      case 'Mudah':
        return 'bg-green-600';
      case 'Sedang':
        return 'bg-yellow-600';
      case 'Sulit':
        return 'bg-red-600';
      default:
        return 'bg-slate-600';
    }
  }

  const renderContent = () => {
    switch (screen) {
      case 'api-key':
        return (
          <div className="flex flex-col items-center justify-center p-8 bg-slate-800 card max-w-sm mx-auto">
            <SparklesIcon className="h-16 w-16 text-indigo-400 mb-4 animate-pulse" />
            <h2 className="text-2xl font-bold text-white mb-2">Masukkan Kunci API Anda</h2>
            <p className="text-slate-400 text-center mb-6">Untuk memulai, masukkan kunci API Gemini Anda. Kunci ini tidak akan disimpan di server.</p>
            <input
              type="password"
              value={apiKey}
              onChange={(e) => setApiKey(e.target.value)}
              placeholder="Kunci API Gemini..."
              className="w-full px-4 py-3 bg-slate-700 text-white rounded-lg border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4"
            />
            <p className="text-xs text-slate-500 text-center mb-6">
              Dapatkan kunci Anda dari <a href="https://aistudio.google.com/apikey" target="_blank" className="text-blue-400 hover:underline">Google AI Studio</a>.
            </p>
            <button
              onClick={handleNextStep}
              disabled={!apiKey}
              className="flex items-center justify-center w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-[1.03]"
            >
              Lanjutkan <ArrowRightIcon className="ml-2 w-5 h-5" />
            </button>
          </div>
        );

      case 'welcome':
        return (
          <div className="p-8 bg-slate-800 card max-w-2xl mx-auto">
            <h2 className="text-3xl font-bold text-white mb-4 text-center">Selamat Datang di AI Penata Rambut</h2>
            <p className="text-slate-400 text-center mb-8">
              Aplikasi ini membantu Anda menemukan gaya rambut sempurna dengan menganalisis wajah Anda.
            </p>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
              <div className="flex flex-col items-center p-6 bg-slate-700 rounded-xl">
                <div className="flex items-center justify-center h-12 w-12 rounded-full bg-indigo-500 bg-opacity-20 mb-4">
                  <CameraIcon className="w-6 h-6 text-indigo-400" />
                </div>
                <h3 className="text-xl font-semibold text-white mb-2">Ambil Foto</h3>
                <p className="text-slate-400 text-center text-sm">Ambil gambar wajah Anda langsung dengan kamera.</p>
              </div>
              <div className="flex flex-col items-center p-6 bg-slate-700 rounded-xl">
                <div className="flex items-center justify-center h-12 w-12 rounded-full bg-fuchsia-500 bg-opacity-20 mb-4">
                  <UserIcon className="w-6 h-6 text-fuchsia-400" />
                </div>
                <h3 className="text-xl font-semibold text-white mb-2">Masukkan Detail</h3>
                <p className="text-slate-400 text-center text-sm">Berikan informasi tentang usia dan pekerjaan Anda.</p>
              </div>
              <div className="flex flex-col items-center p-6 bg-slate-700 rounded-xl">
                <div className="flex items-center justify-center h-12 w-12 rounded-full bg-cyan-500 bg-opacity-20 mb-4">
                  <SparklesIcon className="w-6 h-6 text-cyan-400" />
                </div>
                <h3 className="text-xl font-semibold text-white mb-2">Dapatkan Rekomendasi</h3>
                <p className="text-slate-400 text-center text-sm">AI akan memberikan saran gaya rambut yang dipersonalisasi.</p>
              </div>
            </div>
            <button
              onClick={handleNextStep}
              className="flex items-center justify-center w-full bg-indigo-600 text-white font-semibold py-4 px-4 rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-[1.03]"
            >
              Mulai <ArrowRightIcon className="ml-2 w-5 h-5" />
            </button>
          </div>
        );
      
      case 'form':
        return (
          <div className="p-8 bg-slate-800 card max-w-4xl mx-auto md:grid md:grid-cols-2 md:gap-8">
            <div className="md:col-span-1 mb-6 md:mb-0">
                <h2 className="text-2xl font-bold text-white mb-4">Unggah Foto & Data Diri</h2>
                <div className="relative mb-6">
                    <div className="aspect-w-1 aspect-h-1 mb-4 flex items-center justify-center bg-slate-700 rounded-xl overflow-hidden border-2 border-dashed border-slate-600">
                        {isCameraActive ? (
                            <video ref={videoRef} className="w-full h-full object-cover" autoPlay playsInline></video>
                        ) : (
                            <img
                                src={image ? `data:image/jpeg;base64,${image}` : "https://placehold.co/400x400/1e293b/94a3b8?text=Pratinjau+Foto"}
                                alt="Pratinjau Foto"
                                className="w-full h-full object-cover rounded-xl"
                            />
                        )}
                    </div>
                    <canvas ref={canvasRef} className="hidden"></canvas>
                    {error && (
                        <div className="bg-red-400 bg-opacity-20 text-red-400 text-sm p-4 rounded-lg flex items-center mt-4">
                            <AlertIcon className="w-5 h-5 mr-2" />
                            {error}
                        </div>
                    )}
                </div>
                
                {isCameraActive ? (
                    <div className="space-y-4">
                        <button onClick={handleCaptureImage} className="flex items-center justify-center w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-[1.03]">
                          Ambil Foto
                        </button>
                        <button onClick={() => setIsCameraActive(false)} className="flex items-center justify-center w-full bg-slate-700 text-white font-semibold py-3 px-4 rounded-lg border border-slate-600 hover:bg-slate-600 transition-all duration-300 transform hover:scale-[1.03]">
                          Kembali
                        </button>
                    </div>
                ) : (
                    <div className="space-y-4">
                        <label className="block text-sm font-medium text-slate-300">Unggah dari Galeri</label>
                        <input
                            type="file"
                            accept="image/*"
                            onChange={async (e) => {
                                const file = e.target.files[0];
                                if (file) {
                                  setImage(await fileToBase64(file));
                                }
                            }}
                            className="w-full text-slate-300 p-2 border border-slate-600 rounded-lg bg-slate-700"
                        />
                        <button onClick={() => setIsCameraActive(true)} className="flex items-center justify-center w-full bg-slate-700 text-white font-semibold py-3 px-4 rounded-lg border border-slate-600 hover:bg-slate-600 transition-all duration-300 transform hover:scale-[1.03]">
                           <CameraIcon className="w-5 h-5 mr-2" /> Gunakan Kamera
                        </button>
                    </div>
                )}
            </div>

            <div className="md:col-span-1 space-y-6">
                <h2 className="text-2xl font-bold text-white mb-4">Informasi Pengguna</h2>
                <div>
                    <label htmlFor="age" className="block text-sm font-medium text-slate-300 mb-1">Usia Anda</label>
                    <div className="relative">
                      <div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <UserIcon className="w-5 h-5 text-slate-500" />
                      </div>
                      <input
                        type="number"
                        id="age"
                        value={age}
                        onChange={(e) => setAge(e.target.value)}
                        placeholder="Contoh: 30"
                        className="w-full px-10 py-3 bg-slate-700 text-white rounded-lg border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      />
                    </div>
                </div>
                <div>
                    <label htmlFor="job" className="block text-sm font-medium text-slate-300 mb-1">Pekerjaan Anda</label>
                    <div className="relative">
                      <div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <BriefcaseIcon className="w-5 h-5 text-slate-500" />
                      </div>
                      <input
                        type="text"
                        id="job"
                        value={job}
                        onChange={(e) => setJob(e.target.value)}
                        placeholder="Contoh: Desainer Grafis"
                        className="w-full px-10 py-3 bg-slate-700 text-white rounded-lg border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      />
                    </div>
                </div>

                <div className="mt-8">
                    <button
                        onClick={handleGenerateRecommendation}
                        disabled={!age || !job || !image}
                        className="flex items-center justify-center w-full bg-fuchsia-600 text-white font-semibold py-4 px-4 rounded-lg shadow-lg hover:bg-fuchsia-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-[1.03]"
                    >
                        Dapatkan Analisis <ArrowRightIcon className="ml-2 w-5 h-5" />
                    </button>
                </div>
            </div>
          </div>
        );

      case 'result':
        return (
          <div className="p-8 bg-slate-800 card max-w-4xl mx-auto">
            <h2 className="text-3xl font-bold text-white mb-6 text-center">Rekomendasi Gaya Rambut</h2>
            {recommendations.length > 0 ? (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    {recommendations.map((rec, index) => (
                        <div key={index} className={`relative bg-slate-700 p-6 rounded-xl border-l-4 ${getBorderColor(rec.tingkatKesulitan)} transform hover:scale-[1.02] transition-transform duration-200`}>
                            <h3 className="text-2xl font-bold text-white mb-2">{rec.judul}</h3>
                            <div className={`absolute top-6 right-6 px-3 py-1 rounded-full text-white text-sm font-semibold ${getDifficultyClass(rec.tingkatKesulitan)}`}>
                                {rec.tingkatKesulitan}
                            </div>
                            <h4 className="text-lg font-semibold text-white mb-2">{rec.subJudul}</h4>
                            <div className="prose prose-invert max-w-none text-slate-300 mb-4">
                                <p>{rec.deskripsi}</p>
                                {rec.tipsPerawatan && rec.tipsPerawatan.length > 0 && (
                                  <>
                                    <p className="mt-4 font-bold text-white">Tips Perawatan:</p>
                                    <ul className="list-disc list-inside mt-2 space-y-1">
                                      {rec.tipsPerawatan.map((tip, i) => (
                                        <li key={i}>{tip}</li>
                                      ))}
                                    </ul>
                                  </>
                                )}
                            </div>
                            <button
                                onClick={() => handleOpenGoogleImages(rec.subJudul + ' ' + rec.judul)}
                                className="flex items-center justify-center w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg shadow-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-[1.03]"
                            >
                                Lihat Contoh <ExternalLinkIcon className="ml-2 w-5 h-5" />
                            </button>
                        </div>
                    ))}
                </div>
            ) : (
                <div className="prose prose-invert max-w-none text-slate-300 mb-8">
                  <p>Tidak ada hasil untuk ditampilkan.</p>
                </div>
            )}
            <div className="flex flex-col md:flex-row gap-4">
                <button
                    onClick={handleBackToWelcome}
                    className="flex-1 flex items-center justify-center bg-slate-700 text-white font-semibold py-3 px-4 rounded-lg border border-slate-600 hover:bg-slate-600 transition-all duration-300 transform hover:scale-[1.03]"
                >
                    <ArrowLeftIcon className="mr-2 w-5 h-5" /> Mulai Lagi
                </button>
            </div>
          </div>
        );
      
      default:
        return null;
    }
  };

  const Header = () => (
    <header className="py-4 px-6 md:px-10 flex items-center justify-between">
      <div className="flex items-center">
        <SparklesIcon className="h-8 w-8 text-indigo-400 mr-2" />
        <h1 className="text-2xl font-extrabold text-gradient">AI Penata Rambut</h1>
      </div>
      <div className="text-sm text-slate-400 hidden md:block">
        Temukan gaya rambut sempurna Anda
      </div>
    </header>
  );

  const Footer = () => (
    <footer className="py-4 text-center text-slate-500 text-sm flex items-center justify-center">
      <span>Didukung oleh Gemini AI</span>
      <button onClick={() => setIsModalOpen(true)} className="ml-2 text-slate-500 hover:text-white transition-colors duration-200">
        <QuestionMarkCircleIcon className="w-5 h-5" />
      </button>
    </footer>
  );

  const InfoModal = () => {
    if (!isModalOpen) return null;

    return (
      <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm p-4">
        <div className="bg-slate-800 text-white card max-w-xl w-full p-6 relative">
          <button onClick={() => setIsModalOpen(false)} className="absolute top-4 right-4 text-slate-400 hover:text-white">
            <XIcon className="w-6 h-6" />
          </button>
          <h3 className="text-xl font-bold text-white mb-4">Tentang Aplikasi Ini</h3>
          <div className="space-y-4 text-slate-300 max-h-96 overflow-y-auto pr-2">
            <p><strong>Nama Pembuat:</strong> Arni Apriani S.Pd</p>
            <p><strong>Nama Aplikasi:</strong> AI Penata Rambut</p>
            <p><strong>Tujuan dan Manfaat:</strong> Membantu pengguna menemukan model rambut yang paling sesuai dengan menganalisis bentuk wajah, usia, dan pekerjaan mereka.</p>
            <p><strong>Teknologi AI:</strong> Aplikasi ini menggunakan model canggih Google Gemini AI, <code>gemini-2.5-flash</code>, untuk analisis gambar dan pembuatan rekomendasi.</p>
            <p><strong>Keamanan dan Privasi:</strong> Kunci API Anda disimpan secara lokal di browser Anda dan tidak pernah dikirim ke server kami. Foto yang Anda unggah hanya digunakan untuk analisis sesaat dan tidak pernah disimpan.</p>
            <button
                onClick={() => {
                    setScreen('api-key');
                    setIsModalOpen(false);
                }}
                className="w-full bg-slate-700 text-white font-semibold py-2 px-4 rounded-lg border border-slate-600 hover:bg-slate-600 transition-colors duration-300 mt-4"
            >
                Ganti Kunci API
            </button>
          </div>
        </div>
      </div>
    );
  };
  
  return (
    <div className="bg-slate-900 text-white min-h-screen flex flex-col font-inter">
      <Header />
      <main className="flex-1 flex items-center justify-center p-4">
        {loading ? (
          <div className="flex flex-col items-center justify-center">
            <div className="loading-spinner mb-4"></div>
            <p className="text-lg text-slate-400 font-semibold">Menganalisis foto Anda...</p>
          </div>
        ) : (
          renderContent()
        )}
      </main>
      <Footer />
      <InfoModal />
    </div>
  );
};

export default App;
